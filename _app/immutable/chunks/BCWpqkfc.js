import{d as At,b as dt}from"./nHqQ5mnR.js";import{k as Tt}from"./DLZV-4rG.js";import{s as I}from"./DFJOuHom.js";function Mt(t){let a;for(;a=t.sourceEvent;)t=a;return t}function gt(t,a){if(t=Mt(t),a===void 0&&(a=t.currentTarget),a){var z=a.ownerSVGElement||a;if(z.createSVGPoint){var k=z.createSVGPoint();return k.x=t.clientX,k.y=t.clientY,k=k.matrixTransform(a.getScreenCTM().inverse()),[k.x,k.y]}if(a.getBoundingClientRect){var T=a.getBoundingClientRect();return[t.clientX-T.left-a.clientLeft,t.clientY-T.top-a.clientTop]}}return[t.pageX,t.pageY]}const $t={passive:!1},it={capture:!0,passive:!1};function Lt(t){t.stopImmediatePropagation()}function at(t){t.preventDefault(),t.stopImmediatePropagation()}function Xt(t){var a=t.document.documentElement,z=I(t).on("dragstart.drag",at,it);"onselectstart"in a?z.on("selectstart.drag",at,it):(a.__noselect=a.style.MozUserSelect,a.style.MozUserSelect="none")}function Yt(t,a){var z=t.document.documentElement,k=I(t).on("dragstart.drag",null);a&&(k.on("click.drag",at,it),setTimeout(function(){k.on("click.drag",null)},0)),"onselectstart"in z?k.on("selectstart.drag",null):(z.style.MozUserSelect=z.__noselect,delete z.__noselect)}const et=t=>()=>t;function Dt(t,{sourceEvent:a,target:z,selection:k,mode:T,dispatch:G}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},target:{value:z,enumerable:!0,configurable:!0},selection:{value:k,enumerable:!0,configurable:!0},mode:{value:T,enumerable:!0,configurable:!0},_:{value:G}})}function Pt(t){t.stopImmediatePropagation()}function nt(t){t.preventDefault(),t.stopImmediatePropagation()}var bt={name:"drag"},rt={name:"space"},R={name:"handle"},U={name:"center"};const{abs:yt,max:E,min:x}=Math;function wt(t){return[+t[0],+t[1]]}function ut(t){return[wt(t[0]),wt(t[1])]}var Q={name:"x",handles:["w","e"].map(H),input:function(t,a){return t==null?null:[[+t[0],a[0][1]],[+t[1],a[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Z={name:"y",handles:["n","s"].map(H),input:function(t,a){return t==null?null:[[a[0][0],+t[0]],[a[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ct={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(H),input:function(t){return t==null?null:ut(t)},output:function(t){return t}},D={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},vt={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},_t={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Vt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Bt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function H(t){return{type:t}}function Gt(t){return!t.ctrlKey&&!t.button}function Kt(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function Ot(){return navigator.maxTouchPoints||"ontouchstart"in this}function st(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function It(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function jt(t){var a=t.__brush;return a?a.dim.output(a.selection):null}function Ft(){return ot(Q)}function Ht(){return ot(Z)}function Wt(){return ot(Ct)}function ot(t){var a=Kt,z=Gt,k=Ot,T=!0,G=At("start","brush","end"),X=6,$;function m(e){var n=e.property("__brush",xt).selectAll(".overlay").data([H("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",D.overlay).merge(n).each(function(){var r=st(this).extent;I(this).attr("x",r[0][0]).attr("y",r[0][1]).attr("width",r[1][0]-r[0][0]).attr("height",r[1][1]-r[0][1])}),e.selectAll(".selection").data([H("selection")]).enter().append("rect").attr("class","selection").attr("cursor",D.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var i=e.selectAll(".handle").data(t.handles,function(r){return r.type});i.exit().remove(),i.enter().append("rect").attr("class",function(r){return"handle handle--"+r.type}).attr("cursor",function(r){return D[r.type]}),e.each(N).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",ct).filter(k).on("touchstart.brush",ct).on("touchmove.brush",kt).on("touchend.brush touchcancel.brush",Et).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.move=function(e,n,i){e.tween?e.on("start.brush",function(r){K(this,arguments).beforestart().start(r)}).on("interrupt.brush end.brush",function(r){K(this,arguments).end(r)}).tween("brush",function(){var r=this,u=r.__brush,o=K(r,arguments),S=u.selection,Y=t.input(typeof n=="function"?n.apply(this,arguments):n,u.extent),c=Tt(S,Y);function M(l){u.selection=l===1&&Y===null?null:c(l),N.call(r),o.brush()}return S!==null&&Y!==null?M:M(1)}):e.each(function(){var r=this,u=arguments,o=r.__brush,S=t.input(typeof n=="function"?n.apply(r,u):n,o.extent),Y=K(r,u).beforestart();dt(r),o.selection=S===null?null:S,N.call(r),Y.start(i).brush(i).end(i)})},m.clear=function(e,n){m.move(e,null,n)};function N(){var e=I(this),n=st(this).selection;n?(e.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(i){return i.type[i.type.length-1]==="e"?n[1][0]-X/2:n[0][0]-X/2}).attr("y",function(i){return i.type[0]==="s"?n[1][1]-X/2:n[0][1]-X/2}).attr("width",function(i){return i.type==="n"||i.type==="s"?n[1][0]-n[0][0]+X:X}).attr("height",function(i){return i.type==="e"||i.type==="w"?n[1][1]-n[0][1]+X:X})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function K(e,n,i){var r=e.__brush.emitter;return r&&(!i||!r.clean)?r:new lt(e,n,i)}function lt(e,n,i){this.that=e,this.args=n,this.state=e.__brush,this.active=0,this.clean=i}lt.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(e,n){return this.starting?(this.starting=!1,this.emit("start",e,n)):this.emit("brush",e),this},brush:function(e,n){return this.emit("brush",e,n),this},end:function(e,n){return--this.active===0&&(delete this.state.emitter,this.emit("end",e,n)),this},emit:function(e,n,i){var r=I(this.that).datum();G.call(e,this.that,new Dt(e,{sourceEvent:n,target:m,selection:t.output(this.state.selection),mode:i,dispatch:G}),r)}};function ct(e){if($&&!e.touches||!z.apply(this,arguments))return;var n=this,i=e.target.__data__.type,r=(T&&e.metaKey?i="overlay":i)==="selection"?bt:T&&e.altKey?U:R,u=t===Z?null:Vt[i],o=t===Q?null:Bt[i],S=st(n),Y=S.extent,c=S.selection,M=Y[0][0],l,d,P=Y[0][1],g,b,C=Y[1][0],y,w,V=Y[1][1],v,_,f=0,h=0,tt,W=u&&o&&T&&e.shiftKey,q,J,A=Array.from(e.touches||[e],s=>{const p=s.identifier;return s=gt(s,n),s.point0=s.slice(),s.identifier=p,s});dt(n);var L=K(n,arguments,!0).beforestart();if(i==="overlay"){c&&(tt=!0);const s=[A[0],A[1]||A[0]];S.selection=c=[[l=t===Z?M:x(s[0][0],s[1][0]),g=t===Q?P:x(s[0][1],s[1][1])],[y=t===Z?C:E(s[0][0],s[1][0]),v=t===Q?V:E(s[0][1],s[1][1])]],A.length>1&&O(e)}else l=c[0][0],g=c[0][1],y=c[1][0],v=c[1][1];d=l,b=g,w=y,_=v;var ft=I(n).attr("pointer-events","none"),j=ft.selectAll(".overlay").attr("cursor",D[i]);if(e.touches)L.moved=pt,L.ended=mt;else{var ht=I(e.view).on("mousemove.brush",pt,!0).on("mouseup.brush",mt,!0);T&&ht.on("keydown.brush",zt,!0).on("keyup.brush",St,!0),Xt(e.view)}N.call(n),L.start(e,r.name);function pt(s){for(const p of s.changedTouches||[s])for(const F of A)F.identifier===p.identifier&&(F.cur=gt(p,n));if(W&&!q&&!J&&A.length===1){const p=A[0];yt(p.cur[0]-p[0])>yt(p.cur[1]-p[1])?J=!0:q=!0}for(const p of A)p.cur&&(p[0]=p.cur[0],p[1]=p.cur[1]);tt=!0,nt(s),O(s)}function O(s){const p=A[0],F=p.point0;var B;switch(f=p[0]-F[0],h=p[1]-F[1],r){case rt:case bt:{u&&(f=E(M-l,x(C-y,f)),d=l+f,w=y+f),o&&(h=E(P-g,x(V-v,h)),b=g+h,_=v+h);break}case R:{A[1]?(u&&(d=E(M,x(C,A[0][0])),w=E(M,x(C,A[1][0])),u=1),o&&(b=E(P,x(V,A[0][1])),_=E(P,x(V,A[1][1])),o=1)):(u<0?(f=E(M-l,x(C-l,f)),d=l+f,w=y):u>0&&(f=E(M-y,x(C-y,f)),d=l,w=y+f),o<0?(h=E(P-g,x(V-g,h)),b=g+h,_=v):o>0&&(h=E(P-v,x(V-v,h)),b=g,_=v+h));break}case U:{u&&(d=E(M,x(C,l-f*u)),w=E(M,x(C,y+f*u))),o&&(b=E(P,x(V,g-h*o)),_=E(P,x(V,v+h*o)));break}}w<d&&(u*=-1,B=l,l=y,y=B,B=d,d=w,w=B,i in vt&&j.attr("cursor",D[i=vt[i]])),_<b&&(o*=-1,B=g,g=v,v=B,B=b,b=_,_=B,i in _t&&j.attr("cursor",D[i=_t[i]])),S.selection&&(c=S.selection),q&&(d=c[0][0],w=c[1][0]),J&&(b=c[0][1],_=c[1][1]),(c[0][0]!==d||c[0][1]!==b||c[1][0]!==w||c[1][1]!==_)&&(S.selection=[[d,b],[w,_]],N.call(n),L.brush(s,r.name))}function mt(s){if(Pt(s),s.touches){if(s.touches.length)return;$&&clearTimeout($),$=setTimeout(function(){$=null},500)}else Yt(s.view,tt),ht.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ft.attr("pointer-events","all"),j.attr("cursor",D.overlay),S.selection&&(c=S.selection),It(c)&&(S.selection=null,N.call(n)),L.end(s,r.name)}function zt(s){switch(s.keyCode){case 16:{W=u&&o;break}case 18:{r===R&&(u&&(y=w-f*u,l=d+f*u),o&&(v=_-h*o,g=b+h*o),r=U,O(s));break}case 32:{(r===R||r===U)&&(u<0?y=w-f:u>0&&(l=d-f),o<0?v=_-h:o>0&&(g=b-h),r=rt,j.attr("cursor",D.selection),O(s));break}default:return}nt(s)}function St(s){switch(s.keyCode){case 16:{W&&(q=J=W=!1,O(s));break}case 18:{r===U&&(u<0?y=w:u>0&&(l=d),o<0?v=_:o>0&&(g=b),r=R,O(s));break}case 32:{r===rt&&(s.altKey?(u&&(y=w-f*u,l=d+f*u),o&&(v=_-h*o,g=b+h*o),r=U):(u<0?y=w:u>0&&(l=d),o<0?v=_:o>0&&(g=b),r=R),j.attr("cursor",D[i]),O(s));break}default:return}nt(s)}}function kt(e){K(this,arguments).moved(e)}function Et(e){K(this,arguments).ended(e)}function xt(){var e=this.__brush||{selection:null};return e.extent=ut(a.apply(this,arguments)),e.dim=t,e}return m.extent=function(e){return arguments.length?(a=typeof e=="function"?e:et(ut(e)),m):a},m.filter=function(e){return arguments.length?(z=typeof e=="function"?e:et(!!e),m):z},m.touchable=function(e){return arguments.length?(k=typeof e=="function"?e:et(!!e),m):k},m.handleSize=function(e){return arguments.length?(X=+e,m):X},m.keyModifiers=function(e){return arguments.length?(T=!!e,m):T},m.on=function(){var e=G.on.apply(G,arguments);return e===G?m:e},m}export{it as a,Ft as b,Lt as c,Xt as d,at as e,Wt as f,jt as g,Ht as h,$t as n,gt as p,Mt as s,Yt as y};
